<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ログイン（会員ID）</title>
  <link rel="stylesheet" href="styles.css" />
  <script defer src="app.js"></script>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">会員アプリ</div>
    <nav>
      <a class="btn ghost" href="index.html">ホーム</a>
      <a class="btn ghost" href="board.html">掲示板</a>
      <span data-auth class="row"></span>
    </nav>
  </div>
</header>

<main>
  <h1>ログイン（会員ID）</h1>

  <section class="card" style="max-width:720px">
    <div id="msg" class="item">会員IDでログインしてください。</div>

    <form id="formLogin" style="margin-top:14px">
      <label>会員ID</label>
      <input id="memberId" required placeholder="例：SRN-1234" />

      <div class="grid cols2">
        <div>
          <label>名前</label>
          <input id="name" required placeholder="例：山田 太郎" />
        </div>
        <div>
          <label>年齢</label>
          <input id="age" type="number" min="18" max="99" required placeholder="例：35" />
        </div>
      </div>

      <label>電話番号</label>
      <input id="phone" required inputmode="tel" placeholder="例：09012345678" />

      <div class="row" style="margin-top:14px">
        <button class="btn primary" type="submit">ログイン</button>
        <a class="btn" href="register.html">新規登録（申請）</a>
      </div>

      <p class="small" style="margin-top:10px">
        ※会員IDは、面談後に運営が発行します。
      </p>
    </form>
  </section>

  <script>
  document.addEventListener("DOMContentLoaded", ()=>{
    const form = document.getElementById("formLogin");
    const msg  = document.getElementById("msg");

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();

      const memberId = document.getElementById("memberId").value.trim();
      const name     = document.getElementById("name").value.trim();
      const age      = document.getElementById("age").value.trim();
      const phone    = document.getElementById("phone").value.trim();

      if(!memberId || !name || !age || !phone){
        alert("会員ID・名前・年齢・電話番号を入力してください");
        return;
      }

      msg.textContent = "照合中…";

      try{
        if(typeof gasLogin !== "function"){
          alert("gasLogin が見つかりません（app.jsに追記が必要）");
          msg.textContent = "設定エラー：gasLoginがありません";
          return;
        }

        const r = await gasLogin(memberId, name, age, phone);

        if(!r || !r.ok){
          alert("ログインに失敗しました。入力内容をご確認ください。");
          msg.textContent = "ログインできませんでした。";
          return;
        }

        // OK：会員セッション作成（lineUserId は不要）
        setMemberSession("", memberId);

        location.replace("member.html");
      }catch(err){
        console.error(err);
        alert("通信エラーが発生しました。しばらくして再度お試しください。");
        msg.textContent = "通信エラー";
      }
    });
  });
  </script>
</main>
</body>
</html>